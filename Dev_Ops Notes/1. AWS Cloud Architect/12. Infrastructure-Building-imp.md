- all service based companies mainly focus on infra creation [development, operations and testing]
- Docker container and opendisk[part of infra]  [read more]
- lets say airbnb is client for hcl and dev team coded the site and pushed in to git hub. now we are planning to host and make the application live using aws cloud
- air bnb people knows the requirements[like application size and DB needs] but they dont know about the cloud. they will request a meeting with aws consultant to understand the cloud well
- HCL senior consultant will conduct a meeting with airbnb people to explain  architecture diagrams, document, process of infra creation like
- ### Senior Consultant
	- Machine creation ec2-[t3.medium, 20 gb]
	- Db creation rds-[t3.medium]
	- Redis for Db mangemant-[t2.medium]
	- s3 Buckets
		- [here in this application we create 4 buckets]
		- 1. logs
		- 2. media[images, clients documents, audio file, video file]
		- 3. static content
		- 4. code backup bucket
	- Monitoring - [cloud watch] 
	- Security of application - [security hub] 
	- Management -[load balancer] 
	- Monthly pricing - [billing research this]
- and will give the monthly pricing for all above services
- if airbnb convinced of the above things then project is ok
- senior consultant will meet the team to explain all the above discussed requirements and  discuss about.
- ### Team meeting
	- Netwotk- [172.30.0.0/16]
	- Naming convention - [AirBnb-XXXXXXXX]
	- senoir consultant provide you documentation [if available]
## Job Roles
### Senior Consultant
- creates a AWS account [AirBnb]
### Admin Role
- creates IAM user and gives permission for all services[dedicated permission fro dedicated members]
#### learn this how to give permission to different users
### AWS Cloud Engineer Role
- security
- monitoring

## AWS infra Setup-Document Provided

## 1. Vpc creation[network]  [see 9.1]  [follow Document]
- Create VPC-->name--> SBI-VPC 
- create 4 Subnets[ for higher availability]
	- SBI-Public-subnet-1
	- SBI-Public-subnet-2
	- SBI-Private-subnet-1
	- SBI-Private-subnet-2
	- [1 public and 1 private in one ZONE and other in another ZONE]
	- [public- for webserver]
	- [private- for Data Base(mysql) ]  [but we need internet when we want to update patch for database]
- create internet gateway-SBI-IGW
- create NAT gateway - SBI-NAT-GW
- Create 2 route table
	- 1. SBI-Public-rt - add subnet associations and [link this one with IGW internet gateway]
	- 2. SBI-Private-rt - add subnet associations and [link this one with the NAT gateway]

 ## 2. Security Groups- SG
 - load balancer. Db, web server, redis[ available in vpc bit also you will find option in ec2]
 - first thing we should do is SG for load balancer
 ### 1. SG - load balancer[traffic from out side will first hit the load balancer]
 - -->create-->name : SBI-ALB-SG  [application load balancer - describes which inbound traffic should it allow]
 - -->description : SBI-ALB-SG
 - -->VPC : SBI-VPC
 - [traffic to load balancer will be from the internet- mainly HTTPS, HTTP]
 - -->Inbound rules-->add rule
	 - type : HTTP-->source : anywhere [port : 80 default]
	 - type : HTTPS-->source : anywhere [port : 443 default]
- [port range is always 80 and 443 for load balancer]
- -->launch
- -->change name in the console:SBI-ALB-SG
### 2. SG - Redis 
[we have to allow port for web server]  [so do it in the last]
### 3. SG - VPN
- -->create-->name : SBI-VPN-SG
- -->description : SBI-VPN-SG
- -->VPC : SBI-VPC
- -->inbound rules-->add rule[ VPN has 3 main ports like 12321, 12320, 1194 but they are not available here so take custon tcp]
	- type : custom TCP-->port range : 12321-->source : anywhere [0.0.0.0./0]
	- type : custom TCP-->port range : 12320-->source : anywhere 
	- type : custom UDP-->port range : 1194-->source : anywhere 
	- [we also many other ports since we have to get key, doing ssh and download some scan code form google-->for reference see VPN installation lecture]
	 - type : HTTP-->port range : 80[default]-->source : anywhere 
	 - type : HTTPS-->port range : 443[default]-->source : anywhere 
	 - type : SSH-->port range : 22[default]-->source : anywhere 
- -->create
- -->change name in the console:SBI-VPN-SG
### 4. SG-WEBSERVER(Launch configurations)
- -->create-->name : SBI-WEBSERVER-SG
- -->description : SBI-WEBSERVER-SG
- -->VPC : SBI-VPC
- -->inbound rules-->add rule
- [webserver can be accessed by internet or can be used to ssh]
- [source: : we dont want to access webserver from internet, we want persons who has vpn key should only access webserver--> so change source to VPN]
	- type : HTTP-->port range : 80[default]-->source : SBI-ALB-SG-->description : Open for Load Balancer
	 - type : HTTPS-->port range : 443[default]-->source : SBI-ALB-SG-->description : Open for Load Balancer
	 - type : SSH-->port range : 22[default]-->source : SBI-VPN-SG-->description : Open for VPN
- [here we are restricting who can access and through which ports can access webserver]
- -->create
- -->change name in the console:SBI-WEBSERVER-SG

### 5. SG - RDS
- -->create-->name : SBI-RDS-SG
- -->description : SBI-RDS-SG
- -->VPC : SBI-VPC
- -->inbound rules-->add rule
	- [here we are using MySQL/Aurora and we want to access DB either from SBI-WEBSERVER-SG or SBI-VPN-SG]
	- type : MYSQL/Aurora-->port range : 3306[default]-->source : SBI-WEBSERVER-SG-->description : Open for webserver[webserver can interact with DB]
	 - type : MYSQL/Aurora-->port range : 3306[default]-->source : SBI-VPN-SG-->description : Open for VPN[employee can interact with DB]
- -->create
- -->change name in the console:SBI-RDS-SG

### SG - Redis
- -->create-->name : SBI-Redis-SG
- -->description : SBI-Redis-SG
- -->VPC : SBI-VPC
- -->inbound rules-->add rule
- [redis port is not given in aws--> so use custom port for redis-->6379]  [IMP INTERVIEW QUESTION]
	- type : custom TCP-->port range : 6379-->source : SBI-WEBSERVER-SG-->description : Open for webserver[webserver can interact with DB]
- -->create
- -->change name in the console:SBI-Redis-SG

## 3. IAM Roles
- roles are created to communicate between two services
- here we are creating two roles on for ec2  and another for code deploy
### 1. Role for Ec2- to provide s3 full access to ec2
- we will deploy server in the Ec2- then we need storage space to store logs 
- -->Roles-->create-->aws service
- -->select ec2-->next
- -->select : amazon s3 full access role-->next
- -->name : Rolefors3SBI
- -->create role-->done
### 2. Role for code deploy
- -->Roles-->create-->aws service
- -->search code deploy-->select code deploy-->next
- -->select : code deploy role-->next
- -->name : RoleforcodedeploySBI
- -->done

 ## 4. Create Launch Configuration
 - there are 2 ways to create launch config
	 - 1. Launch Configuration option
		 - first we specify launch configurations[AMI image, type, s/w to be installed, GB] of webserver and attatch it  to-->auto scaling-->thats it our machine is ready[automatically] with auto scaling
	 - 2. launch template option
		 - create template+auto scaling group-->automatically our machine is ready
- [but when ever you create a launch configuration we have to attatch load balancer-->so create load balancer first]
## 5. create Load balancer
- -->load balancers-->create LB
- [here we are creating Application Load Balancer]
- -->select Application Load Balancer
- -->name : SBI-ALB
- -->VPC : SBI-VPC
- -->mappings : us-east-1a and us-east-1b [select both zones]  [ALB always done on public subnets ]
- -->SG : SBI-ALB-SG
- -->listener and routing : -->create target group[health check]
	#### Target Groups
	- used to check the health of ec2 instances
	- after load balancer divides traffic among the machines. target group will [check the health of machines]. if one among the machine is unhealthy [lets say apache got corrupted and server down]then it will [remove the unhealthy machines]
	- -->create target group-->select instances
	- -->name : SBI-TG
	- -->VPC : SBI-VPC
	- -->health check : http-->next
	- -->create TG-->done
- -->refresh the TG-->select SBI-TG
- -->create Load Balancer-->done
## 4.1. Create Launch Configuration
- go to launch cofiguration-->create launch configuration
- -->name : SBI-LC
- -->AMI : [company will specify AMI]  [-->instances-->launch-->browse more and copy instance name and paste it here--> select the first one]
- [we select it for the practice purpose]
- [AMI s are compatible with regions so be carefull while selecting the AMIs]
- -->instance type : t2.micro [usually senior consultant will specify this]
- -->iam instance profile : Rolefors3SBI [check naming convention-->RoleForS3SBI]
- -->storage : EBS volumes-->for now 8 gb is fine
- -->SG -->select an existing group :SBI-WEBSERVER-SG
- -->key pair-->create key pair-->name : venkatesh.pem-->download
- -->launch config-->done
## 4.2. Create Auto Scaling Group
- -->create ASG-->name : SBI-ASG
- -->launch template : switch to launch configuration[ if you have SBI-LC]
- [you have another option of switch to launch template-->if you have launch template]
- -->next
- -->VPC : SBI-VPC
- -->subnets : select two private subnets[webserver should be private]
- [all the traffic comes from load balancer]
- -->next
- -->load balancer : choose an existing one
- -->target group : SBI-TG
- -->health check grace period : 30 sec[your wish]
- -->next
- -->group size
	- -->desired-->2
	- -->min-->1
	- -->max-->5
- -->next
- -->next
- -->add tags-->key : Name , Value : SBI-Webserver
- -->next
- -->create ASG-->done
[automatically 2 instance are launched since we choose 2-desired machines]
[we host our application on these machines]

## 6. Create S3
- create 4 buckets
	- 1. logs
	- 2. media[images, clients documents, audio file, video file]
	- 3. static content
	- 4. code backup bucket
[s3 is a global service. but buckets are region specific]
- 1. sbi-media-bucket-8145[unique name]
- 2. sbi-static-bucket-8145
- 3. sbi-log-bucket-8145
- 4. sbi-code-backup-bucket-8145

## 7. Create Cloud Front distribution [see 10.last]
- to achieve low latency [data in s3 is stored in edge locations]
- go to Cloud Front-->create distributions
- -->origin domain-->sbi-static-bucket-8145[since static content is stored in this bucket]
- -->origin access-->leagcy access identity OAI-//[since our content is static // there are 3 option. 1. public 2. OAC- for dynamic website content 3. OAI- for static content]
- -->create new OAI-->create // [automatically creates a new OAI ]
- -->yes update the bucket policy 
- -->price class //[where do you want your website visible]
- -->default root object-->index.html //[since our website is a html website-# research more for other type of websites we use more in organization]
- -->description-->SBI-static-distribution // [any name to remember]
- -->create distribution
### view website
- -->copy distribution domain name -->paste in new tab-->done
- -->successor 

- -->[in organizations we get ssl certificate for our website and map it to domain name ]
## 8. Create RDS
- [senior consultant will specify the DB like type, size , name and password]
- -->create database-->choose Amazon Aurora
- -->version [if not specified leave it as it is]
- -->settings-->Db cluster identifier-->SBI-DB_Cluster
- -->masters user name-->admin
- -->masters password-->Vs2architect22[keep a very secure pswd- hackers will easily hack- if not use pswd generator]
- -->db instance class-->t3.small[see requirement]
- -->availability and durability-->replicate[see requirement]
- -->VPC : SBI-VPC
- -->SG : SBI-RDS-SG
- -->AZ : us-east-1a
- -->create DB-->done

## 9. Create redis-[Amazon MemeoryDB for Redis]-Elastic Cache
- [used to manage the DB]
- -->Elastic Cache-->redis cluster-->Create Redis Cluster
- -->name : SBI-Redis
- -->multi AZ[check according to requirements]
- -->node type : t2.micro
- -->subnet group settings-->name : Redis-Sgs
- -->VPC : SBI-VPC
- -->selected subnets-->manage-->choose pvt subnets
- [here we take only private subnets-->DB]
- -->next
- -->SG : SBI-Redis-SG
- -->next
- -->create-->done
## 10. SNS 
- [for notifying when cpu usage above 70%]
- -->topic-->create topic-->standard
- -->name : SBI-SNS
- -->create topic
- -->create subscription
- -->protocol : email
- -->end point : venkateshchowdary1@outlook.com
- -->create subscription
- [you will get a mail to you once you confim then it will confirm ]

## 11. Cloud watch for monitoring
- lets say we want to watch the cpu of ec2 instances
- -->all alarms-->create
- -->select metrics
- -->select Ec2 or RDS
- -->per instance metric[depending up on requirement]
- -->select cpu utilization[here there are two instances since we launched 2 instances]
- there are many more functions we can explore[research them]
- -->select metrics
- select if our SBI-Webserver max 5 min >70% usage[choose appropriate options]
- -->statistic : maximum
- -->period : 5 min
- -->than 70-->next
- --.select sns : SBI-SNS-->next
- -->alarm name : SBI-CPU-MAXIMUM-UTILIZATION
- -->create alarm[there are so many settings have a look]
- -->done
- [in company we will have a dedicated mail id to watch this]
- lets say you want to watch this in dashboard
- -->select this alaram-->actions-->add to dashboard
- -->create[since we dont have a dashboard]
- -->name : SBI-->add to dashboard
- -->go to dashboard-->SBI
- -->widget type-->different type of metrics
- [monitoring is alone a profile in company]

## 12. Create VPN [see 7]
- [launch and configure VPN ]
## 13. create Elastic Ip[see 7]
- -->name : SBI-Elastic-IP
- -->create

- [document provided for vpn setup]
- // one thing is whenever you create vpn give it an elastic ip
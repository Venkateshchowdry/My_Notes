
### YB madhusudana reddy youtube channel
[find diff between jenkins and ansible]  [research]

- open source tool - configuration mangement tool
- and application deployment tool in IAAS-->sponsered by redhat
- let us say we have 10 servers. and we want to [install docker image or check disk space or check time etc.., ] in each one of them[connects through ssh : port 22]. so using ansible we can automate the installation of docker image at a time-very usefull.
- uses YAML scripting
- works on [push management]
- it is agent less and [communicates through ssh] cmd 
- ![[Pasted image 20221028145902.png]]

### Playbook
- automate scripts in YAML/YML[both same] file are called [playbooks] - which run on Ansible-Server-master
- execution of playbook-->PLAY
### Module-ubuntu
- set of cmds to be executed client side
- -->ansible all -m ping -i [path where we stored the host folder] --private-key=[path where we stored the key]
### Adhoc cmds -ubuntu
- [adhoc cmds] can be performed individually to perform a quick function
- -->ansible all -a "df-h" -i [path where we stored the host folder] --private-key=[path where we stored the key]
- -->ansible servers -a "uptime" -i [path where we stored the host folder] --private-key=[path where we stored the key]

## Create Ec2 master instance
- -->go to ec2-->launch instance-->Red Hat Enterprise Linux 8 64 bit x86
- [like while installing VPN we choose powered by turn key for this redhat is the best server]
- or we can select any linux server-->ubuntu[personal favourite]
- //which ever server you choose but try to google their own cmds
- -->instance type-->t3. medium[depends on requirement]// for now select free tier
- -->key : name -->value : Ansible-Server [to access from anothe server]
- -->key pair : create a new key pair [Ansible-Key]
- // a key will get downloaded
- -->create security group-->allow ssh :port 22//default port
- //attatch security group - we can also change the ports later
- -->launch
- [just like the VPN server Ansible server is a different instance in aws]
- -->copy public ip of the Ansible-Server
- [open MobaXterm software tool]
## Create host instances[nodes]
[generally servers are already installed]
- select our ec2 instance
- -->actions-->image and templates-->launch more like this
- -->name : give different names
- -->every configuration is same 
- but mention the number instances :may be 3 or 4-->launch

### Communicate between them
now we have to communnate with out master server we can do this in multiple ways
- 1. from cmd prompt
- 2. using ec2 instance connect from aws console
	- -->select our instance
	- -->connect-->ec2 instance connect[same as CLI terminal]
- 3. using [third party app MobaXterm] for RedHat

## Ubuntu-Server
- after opening ec2 instance connect
- -->sudo apt update [updating server]
- -->sudo apt install ansible
- -->y
- -->cd .ssh
- now we are at .ssh directory
- -->vim ansible_key[copy the Ansible-Server key which you created while launching instance]
- -->i
- -->paste the Ansible-Server key here
- -->esc-->:wq!
- -->pwd [you can check the key stored here]
- -->ls
- -->[using this key we can connect to other hosts]
- //since the same key is key for all the other hosts
- copy the public ip adress of the host you want to connect and 
- -->sudo ssh -i /.ssh/ansible_key ubuntu@[public IP]
- -->yes
- [this is called secured shell]
- //now we are in host server we can do anything here
- -->exit
## Adding Inventory File
- -->cat /etc/ansible/hosts [default folder adding host servers]
- -->mkdir ansible
- -->cd /ansible[open ansible]
- -->vim hosts
	- -->i
	- //write the following code
	- [server] // this should be inside the bracekts
	- server1 ansible_host=[host server IP]
	- server2 ansible_host=[host server IP]
	- server3 ansible_host=[host server IP]
	- //we can add any number of servers
	- // we can also specify the which variable should be present in the host servers
	- -->[all:vars]//this should be in the brackets
	- -->ansible_python_interpreter=/usr/bin/python3
	- -->esc-->:wq!
- -->ansible-inventory --list -y
- // it will look for the inventory hosts which we saved
- //here we saved the hosts in another location so we have to specify the path for the inventory to locate the host
- -->pwd // to find the [path]
- -->ansible-inventory --list -y -i [path/hosts]  //where the hosts file was saved
- [now we will see all the hosts information and configuration we stored in the hosts file]
### Test the connection
- -->ansible all -m ping -i [path/hosts] --private-key=~/.ssh/ansible_key       
 [ just pinging the client servers]
- cd .ssh[to go inside the folder]
- cd ..[ to exit the folder]
- [we have to give the permission for the key to read]
- -->chmod 700 ~/.ssh [research the modes : read / write]
- -->chmod 600 ~/.ssh/ansible_key
- -->
- -->ansible all -m ping -i [path/hosts] --private-key=~/.ssh/ansible_key
- -->success
- -->ansible all -a "free -h" -i [path/hosts] --private-key=~/.ssh/ansible_key
- [will return the disk space free in each server]


### Play book- Creating a file
- //now we are in ansible folder
- -->mkdir playbooks
- -->cd playbooks
- -->ls
- create a file in hosts automatically
- -->vim create_file.yaml or -->vim create_file.yml [both are fine]
- -->i
- [yml files start with ---]  [and it follows indendation of python]
**---
-name: This playbook will create a file [list starts with - symbol and space after that]
 hosts: all [runs on all servers]
 become: true [means we are root user]
 tasks:
  -name: creating a file [another list]  [modules start from here]
    file:   [file is name of module]
    path: /home/ubuntu/anyfile.txt
    state: touch 
   
- -->esc-->:wq!
### To run these play book
- -->ansible-playbook create_file.yml -i [inventory path] --private-key=~/.sss/ansible_key
- //inventory path =/home/ubuntu/ansible/hosts [here]
- // changed = 1 [means playbook make change in servers]
- // changed =0 [means playbook is run but it checks if the task is already done then it wont do it again]  [research]

### Play book- Creating a User
- -->vim create_user.yml
- -->i
**---
-name: This Playbook will create a user
 hosts: all
 become: true
 tasks:
  -name: Create a user Venkatesh
    user: name=Venkatesh [user is a module in ansible ]

- -->esc-->:wq!
- -->ansible-playbook create_user.yml -i [inventory path] --private-key=~/.sss/ansible_key

- -->cat /etc/passwd [ to check whether the user is created or not]
- //search on google for cmds
### Play book-Installing a Docker
- -->vim install_docker.yml
- -->i
**---
-name: This playbook will install Docker
 hosts: all
 become: true
 tasks:
 -name: Add Docker GPG apt Key[first task]
	  apt_key: 
		  url: https://download.docker.com/linux/ubuntu/gpg
		  state: present
 -name: Add Docker Repository[second task]
	  apt_repository:
		  repo: deb https://download.docker.com/linux/ubuntu focal stable
		  state: present
 -name: Install Docker[third task]
	 apt:
		 name: docker-ce [docker community edition]
		 state: latest

- -->esc-->:wq!
- -->docker[cmd to find whether docker is installed or not]
- -->ansible-playbook install_docker.yml -i [inventory path] --private-key=~/.sss/ansible_key
### Update servers - before installing Docker
- -->ansible all -m apt -a "upgrade=yes update_cache=yes cache_valid_time=86400" --become







### Play book- 
### Play book- Creating a file
### Play book- Creating a file
### Play book- Creating a file


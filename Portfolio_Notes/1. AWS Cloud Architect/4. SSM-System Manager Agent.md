## Lect 6
## SSM agent- server access
- SSM is a aws service
- There are many teams like developer team, testing team, devops team and aws team working on different services like s3, vpc, cloud distribution team, deployment team etc
- we cannot grant access for ec2(server) to every one lets say 50 employees due to security breach. since traffic is from internet
- used to access application server with out a direct access by installing a ssm agent on server- for say when developer want server access to patch or update or when devops person want to install docker in server- he wants to access server. 
- ex: database server always in private not public
- aws admin- has to secure the ec2
- aws architect- whole architecture
- aws engineer-azure, gcp,aws knowledge in creating infrastructure
- cloud is only used to create infra / migrate infra for a company
## SSM Agent
- install a ssm agent on ec2(server)
- to communicate between two services in aws(here ssm agent and ec2) we need to create a IAM role and attach to server.
## create ec2 instance
- go to create ec2
- -->instance
- -->launch instance
- -->name:Webserver
- -->linux image
- -->t2.micro
- -->create key pair name: My-key[a file key.pem will be downloaded]
- -->allow all http traffics
- -->launch instance
## Access server from cmd prompt
- -->copy instance public ip
- -->open cmd-->cd downloads[key pair is in downloads]
- -->**ssh ec2-user@publicipv4 -i My-Key.pem
- -->**yes(it will connect to ec2 linux 2 AMI)
- -->**sudo -i(to go to root)
- //*now we want to install ssm agent
- //*goolge installation amazon.ssm.agent-->select linux 2
- -->copy command of x86_64(not ARM) of region specific
- -->paste in cmd and change the region name(us-east-1 @2 places)-->hit enter-->complete-->check status using another cmd
- #*[if ssm agent is already installed just check the status- active running]
## Create IAM role
- to communicate between ec2 and ssm
- go to IAM-->roles-->create role-->aws service
- -->ec2-->next
- -->search ssm
	- -->add AmazonEc2RoleforSSM and AmazonSSMManagedInstanceCore
	- -->or add AmazonSSMFullAccess(either)-->next
- -->role name:roleforssm-->create role
## Attatch to EC2
- go to ec2 instance
- -->actions-->security-->modify IAM role-->select the IAm role-->update IAM role
- thats it-done everything[no need to touch server- just go to ssm agent in aws you can do any operations from this 
	- like running cmd
	- patch server/update server]
## operations on SSM
### Run Command- To install any thing on any server without going to server
- go to ssm agent in aws
- -->select run cmd in right hand side bar-->run a command
- [you will find what alll operations you can install on server without going to a server]
- lets say you want to install apache server and host a html website/page
- -->search shell script-->select aws-Runshellscript[for mac-linux. for our system search windows and linux]
- [first check apache is installed using]**systemctl status httpd[ in cmd prompt-if not then install apche]
- -->**systemctl status httpd /*to check apache installed or not*
- /*above cmd should be type at root@publicip(amazon ec2 ip*
- -->in commands--> type the following [in aws ssm run cmd]
- [you can write any installation code here]
	## for mac and linux
	 yum install httpd -y
		systemctl start httpd
		systemctl enable httpd
		cd /var/www/html //*[creates html file*]
	echo "welcome to my ssm practicle by installing apche server" >index.html
	//*[writes into html file] *
- -->reduce the execution time our
- -->target--> choose instance manually-->select our web server ec2
- [very usefull if you want to install on multiple servers at a time- works like ansible]
- -->comments-->installing httpd
- -->time out-->60[untill when do u need response if not installed]
- -->output options-->enable s3 bucket[to store logs, output of the above installation process- for now disable this option] 
- -->run
### To check status of httpd
- -->systemctl status httpd
- -->cd /var/www/html
- -->cat index.html
- -->systemctl status restart //[restart the web server]
- ---> copy the public ip from the instance and paste in the browser you will get the web page-->**success
### Advantages of ssm
- you can install everything from here dependecies too
- 
## Practice more like
- install apache
- install docker
- install node dependency
- install php 
- install db connections
- every thing which we do on a server
## Patch manager
- used to patch the server
- -->patch now
- -->scan and install
- -->reboot if needed
- -->patch only target instance
- -->choose manually
- -->select our instance
- -->patch
- -->success-->green
## procedure used in companies
- -->ec2 instances-->connect-->you will get many options
	- sessions manage
	- ssm client and two more
- dont give ip and key to any other developers bcoz of security
- instead ask them to log in with their IAM user-credentials and grant full access to ssm and ec2 
-  they go to ec2-->connect-->sessions manager-->connect-->developer can work from here/ devops person can install docker from here as well


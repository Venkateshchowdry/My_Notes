## Lect 10
## VPN server- more secure way-individual access key
- lets assume in a company code pushed  into github and deployed in to web server[private] using jenkin server or git clone or some other method
- every employee needs to acess web server and by chance one employee did changes to the application then service will stop/down so its a problem
- [so we need a more secure way to protect server and need a mechanism to find who did what changes]
- web server is always private -[best practice]
- so we add a another server[VPN server] 
- then configure VPN server-->create/generate vpn access key for added individual employee profile in vpn server 
- use vpn software[VPN connect] -->download in your pc-->upload the access key in that s/w --> then employee can acess the webserver[private IP] using terminal/cmd/powershell
- every emp has their own access key and vpn profile
- backend monitoring team will find if some one make a mistake inthe main web server[private]---[more secure]
- vpn server also acts as jump server[will do both works]
- no need for any extra server[jump server] u can access from the local machine

###### two servers should be in same network VPC[virtual private cloud]

## Creating VPN server
- -->launch instance-->name: SBI-VPN-Server
- -->AMI-->[we need vpn server-->go to aws market place-->search turnkey-->powered by turnkey firstone-->its a paid version ]
- terminate this after using it
- -->t2.micro
- -->access key-->same for the webserver-->venaktesh.pem
- ->network settings-->edit
	- -->vpc --> default [same as pvt web server]
	- -->subnet-->us-east-1a [same as web server region]
	- -->auto-assign-public IP-->enable
		- -->security group-->SBI-VPN-SG
		- [VPN has 3 ports - custom TCP
			- 12321
			- 12320
			- 1194 [you will see all of them in console]]
- -->launch instance
- [when ever we create VPN server always give a elastic ip]

### Elastic Ip-[static IP]-it will never change
- -->elastic ips-->allocate elastic ip address-->allocate
- -->actions-->associate elastic ip address-->select our SBI-VPN-Server-->select Ip shown-->associate 

## Configure Vpn servver-[Document Provided]
- -->cd Downloads
- -->ssh admin@[vpn ip] -i [access key]   //public ipv4
- -->ssh admin@[vpn ip] -i venkatesh.pem  [important]
- [ when ever we create VPN use a elastic IP ]//*so that it wont change in future- it is a paid one *
- // a blue screen will open
- -->asks for pasword-->enter pswd 8 char [venkat@1234]-->confirm pswd-->
- -->choose profile -->server -default option//[we are creating VPN to grant access to employees]
- -->email -->venkateshchowdary1@outlook.com [give company email]
- -->ip address reachable by clients-->elastic public ip
- -->virtual subnet ip-->keep it default[research about it]  [this ip address range should not be in pvt ip range of vpn]
- so that vpn allote ips to its employees
- -->open vpn pvt subnet-->cidr ipv4 of the vpc[ used while creating instance]
- [search vpc in aws console-->select region-->select vpc-->copy cidr ipv4]
- -->paste it in application-->you will see a series of dits in cmd prompt
- -->[it will take more than 5 min please be patient.......................]
- -->api key [we dont have so skip]
- -->sys notification and security alerts-->check email id-->save-->
- -->security updates-->install-->//it will install some dependies[for regular security updates]
- -->reboot-->[dont do reboot]-->skip
- [since if you reboot ip will change- thats y we should take static ip whenever we launch vpn server so it will not change after reboot]
- //*strictly use elastic ip when creating vpn server*
- -->advance menu
- -->quit
- -->clear
- [done]  [again back to cmd]

### back to cmd
- you are in vpn server now as admin
- -->vim venkat.pem [copy the venkat.pem content ]
- -->paste the venkat.pem content -->esc-->:wq![to save and exit the content]
	- [read all operation we can do using vim cmd 
		- i-->inset mode
		- /-->search mode] ] // and many more 
- -->chmod 400 venkat.pem[giving permission]
- now you can access private web server from here
- 
- -->ssh ec2-user@[web server pvt ip] -i venkatesh.pem
- [// some time it says venkatesh.pem is denied
- so copy again the key and paste in vim command again]
- -->accessed-->success 
- -->sudi -i
- we accessed main web server but we should access via vpn key

## Add Client and Generate vpn key
- -->exit // from root ip
- -->exit from web server server
- now you are at admin@vpn
- [add clients to the vpn server and generate access keys]
- -->sudo openvpn-addclient venkatesh venkateshchowdary1@outlook.com  [profile creation]
- -->sudo /var/www/openvpn/bin/addprofile venkatesh [profile adding]
- [name above is same as name used in addclient]
- //then we get an URl -->copy URL-->
- [copy from https]
- paste in web browser-->advance-->proceed-->download key
- -->open software-->OpenVPN connect v3

## download openVpn Connect s/w and connect
- -->install OpenVPN Connect v3[ google openVPN connect for windows]
- -->u will see url and file upload option
- -->upload the file we down loaded above
- -->connect

now you can access private web server from cmd 
## Access Private web server from local machine with VPN
- cmd
- -->cd Downloads
- -->ssh ec2-user@[private ip] -i venkat.pem
- -->yes
- -->sudo -i

## Errors
- if connection timed out error seen in the cmd prompt then it is bcoz of the security groups 
- 


- --> vpn can be used to access database and web servers[always private] in a company
- practice  more with the help of document provided
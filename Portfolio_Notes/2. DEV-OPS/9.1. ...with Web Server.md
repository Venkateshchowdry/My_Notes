
- in companies after developer push code to the github
	- jenkins will build the code and send output and trigger ansible server playbook
		- In playbooks it is defined to deploy it to the web server
![[Pasted image 20221115003511.png]]

- we need 5 servers
	- Jenkins-Server
	- Web-Server [in companies it is in ASG to scale depends on traffic]
	- Ansible-Server
	- Developer-Server[local host] and pushes code to github
	- Github
- jenkins and ansible server has password less authentications[research this]

## 1. Jenkins-Server
- create ubuntu instance ami in aws and connect in cli
	- install jenkins[see 3]
		- access through web browser
## 2. Ansible-Server
- create ubuntu instance ami in aws and connect in cli
	- -->sudo apt update
	- -->sudo apt install ansible
	- -->vim /etc/ansible/hosts
		- -->i
		- -->[web]
		- -->ip of webserver
			- here i take the private ip of web server
				- or choose according to SG
		- -->esc -->:wq
## 3. Web-Server
- create ubuntu instance ami in aws and connect in cli
- -->sudo apt update
- -->sudo apt install apache2
- -->apache2 -v
	- to find version of apache tomcat
- -->sudo systemctl start apache2
- -->sudo systemctl enable apache2
- -->sudo systemctl status apache2
- [in place of apache2 we use httpd in amazon linux and rhel centos]
- -->cd /var/www/html/
### creating password less connection between ansible and webservers
- here we have only one web server
- go to ansible server
- generate key
	- -->ssh-keygen
		- it will ask for key name : so I gave venkat.pub
- share the key with web server
	- -->ssh-copy-id -i venkat.pub root@[private ip of web server]
#### set password for root login and enable in sshd_config
- here we are getting an error bcoz root login of webserver is not open 
- so[ enable root of webserver]
- set password for root user[admin pswd] of webserver
	- go to web server CLI
		- -->sudo su
		- -->passwd root
		-  -->new password : 12345
		- - -->retype : 12345
			- -->success
				- [go to ssh configuration file]
				- -->vim /etc/ssh/sshd_config
					- search for these two
					- PermitRootLogin yes
						- [uncomment] this one
					- PasswordAuthentication no
						- change this one to [yes]
					- esc -->:wq
			- -->systemctl restart sshd
- go back to ansible server CLI and share the key with the webserver
	- -->ssh-copy-id -i venkat.pub root@[private ip of web server]
		- key added successfully 
- --> ssh root@[web-server private IP]
	- [we are accessing webserver from ansible server without password]
		- success
- -->exit for webserver
### same as above password less communnication between jenkins and ansible server
#### jenkins server 
#### ansible server
here we are sharing the key between two servers
- do the same process and access ansible server from the jenkins server
## 4. generate a playbook in ansible
- -->mkdir sourcecode
- -->cd sourcecode
	- -->vi playbook.yml [it follows indendation]
		- we are creating a simple copy playbook
		- -hosts : all
		- tasks:
			- - copy : 
				- src : /opt/index.html [in this folder our jenkins server will place the build file, index.html is the filename if we dont know we will ask developer]
				- dest : /var/www/html [of the webservers]
				- esc-->:wq
## Git hub
- select a repo and create a file name index.html since it is the file name we mention in the play book
- -->created Birds
	- created index.html
		- echo "this is a index.html page"
### integrate this repo with jenkins[see 3.3]
 - -->11d5d533abdfd7288477ac80c7dfc8c56e
	 - token for Birds repository
- -->done
### go to jenkins
- once the build process is done by jenkins it will send the output to the ansible server through ssh. 
	- to trigger the ansible play book
#### install plugin- publish over ssh
- -->go to jenkins server dashboard
	- -->manage jenkins 
		- -->plugin manager
			- -->available -->search : ssh
			- -->publish over SSH
			- -->install without restart
			- -->check the box stating restart jenkins when installation is complete
			- [jenkins will restart]
### create job in jenkins
- -->new item
	- -->name : Birds_Project
		- -->free style [types]
			- -->scm :git [paste birds repo url]
			- -->build trigger : git hub hook trigger for git scm polling
				- trigger whenever developer pushes the code
			- -->build : 
## build actions
- -->add buils step : select-->send files or execute cmds over ssh
	- [ here we want to send the files from jenkins server to ansible server]
		- we have to add server datails and execute cmds
### adding jenkins server details
- -->dashboard
	- -->manage jenkins
		- -->configure system
			- -->all the way down till we see SSH server option
			- [it is here bcoz we installed publish over ssh plugin]
### ssh server 
- add ssh server
	- name : jenkins
		-  host name : private ip of the jenkin server
		- user name : root
		- click use password authentication
			- password : 12345 [password of the jenkins server]
			- [set the root password of the jenkins server using the same method below]
			- after adding click [test connection]-->success
				- if it is good everything is good
- -->apply-->save[exit]
go to web server CLI
				- -->sudo su
					- -->passwd root
					- -->new password : 12345
					- -->retype : 12345
					- -->success
				- [go to ssh configuration file]
				- -->vim /etc/ssh/sshd_config
					- search for these two
					- PermitRootLogin yes
						- [uncomment] this one
					- PasswordAuthentication no
						- change this one to [yes]
					- esc -->:wq
			- -->systemctl restart sshd
### go back to the job configuration tab
- -->build
	- -->send files and execute over ssh
		- -->name : jenkins[we see this option here]
		- we have to run a cmd in jenkins server such that after building it will send the file to ansible server 
			- and ansible server will deploy it in the web server
		- -->execute cmd : 
		- rsync -avh /var/lib/jenkins/workspace/Birds_Project/*.html root@172.30.0.95:/opt/index.html
			- path of the file where job output is saved
			- and root @[ansible server pvt ip]/[path where we defined in the playbook]
// for me build is unstable since it is not posting the build file inside the ansible server
check it

## post build actions
trigger the playbook from the jenkins-
- -->configuration
	- -->post build action
		- select : send build artifact over ssh
		- name : we dont have ansible server here
		- [so add ansible server to trigger the playbook]
- -->go to dashboard
	- -->manage jenkins
		- add ssh server
			- name : ansible 
			- host name : pvt ip of ansible 
			- username : root
			- use pswd authentication
				- 12345
			- test connection : success
- 
- configuration
	- name : ansible
	- exe cmnds : 
		- -->ansible-platbook /sourcecode/playbook.yml
		- apply-->save

you can see the web server public ip 

done 